# 项目开发规范
## 项目信息

- 项目名称: [仓库名/项目名]
- 项目类型: SLAM 系统 / 多传感器融合 / 机器学习训练与部署 / ROS 工程
- 主要语言: C++（核心实时模块） / Python（训练、数据处理、评测、工具链）
  - 可复现: 训练与评测必须可复现（seed、配置、版本可追踪）
  - 可部署: 支持离线评测（bag/dataset）与在线运行（真机/仿真）

 ## 命名规范

### 文件命名

- 格式: [功能]-[描述].[类型].[ext]
- 全小写，中划线分隔 
  
### 修改原则（根治而非掩盖）

- IMPORTANT: 根本解决问题。

- 必须定位根因类别（至少归入一类）：

- 坐标系/变换方向定义错误

- 时间戳对齐与插值外推错误

- 数学推导与实现不一致（雅可比/扰动模型）

- 数值稳定性问题（归一化、条件数、发散）

- 并发竞态（读写无序、生命周期错误）

- 配置不合理（阈值/噪声/尺度失配）

- 禁止通过“加判断跳过”掩盖 bug：

- 允许临时保护，但必须同时补充：告警 + 根因任务 + 验证用例

## 代码复用

IMPORTANT: 禁止重复实现已有功能

- 相同代码出现 2 次 → 必须提取为公共函数
- 超过 10 行的业务逻辑 → 考虑复用
- 简单条件判断 → 不必过度抽象
- 新建文件前 → 先搜索是否已有类似功能
- 公共模块禁止依赖业务模块，避免循环依赖

## 代码健壮性

### 错误处理

- 异步操作必须有错误处理机制
- 错误分类处理:
  - 验证错误 → 返回字段级详情
  - 业务错误 → 返回用户友好提示
  - 系统错误 → 记录日志，返回通用错误
- 错误向上传播时补充上下文信息

### 输入验证

- 所有外部输入必须验证 (API 参数、用户输入、文件内容)
- 使用成熟的验证库
- 验证失败返回明确错误信息

### 边界检查

- 集合/数组访问前检查索引边界
- 除法前检查除数非零
- 空值检查 (null/undefined/nil/None)
- 类型转换前验证数据有效性
- 资源申请后确保释放 (连接、文件句柄、锁等)

## 修改原则

IMPORTANT: 根本解决问题

- 找到 root cause，从根本上解决
- 正面面对问题，不绕过不回避
- 复杂问题先说明根本原因，再讨论方案
- 禁止打补丁、用 hack、投机取巧
- 禁止因为"能跑"就不深究

### 代码清理

- 废弃代码: 确认无引用 → 直接删除
- 重复实现: 统一为一个 → 删除其余
- 死代码: 注释代码块、未使用的变量/函数 → 删除
- 历史遗留: 开发阶段大胆重构，不背历史包袱
- 不保留"以防万一"的代码

### 修改范围

- 只改必要文件，不顺便改无关代码
- 修改前先理解现有代码意图
- 修改后运行相关测试确认无回归

### 兼容性

- 仅对外发布的 API/SDK 需考虑向后兼容
- 内部开发阶段: 该改就改，该删就删

## 配置管理

- 敏感信息: 环境变量注入，禁止硬编码
- 优先级: 环境变量 > 配置文件 > 默认值
- 环境隔离: dev / test / prod 配置独立

## 文档与注释

- 公共函数/方法: 文档注释说明参数、返回值、异常
- 业务逻辑: 注释说明"为什么"而非"做什么"
- 复杂算法: 注释解释核心思路
- 代码变更: 同步更新相关文档

## 禁止事项

- 硬编码密钥、密码、敏感信息
- 提交调试输出语句到代码库
- 单文件单独建文件夹
- 公共模块依赖业务模块
- 用错误处理吞掉异常假装没问题
- 用条件判断绕过 bug 而不修复
- 复制粘贴已有代码而不复用
- 保留"以防万一"的废弃代码
- 删除或跳过失败的测试来让构建通过

## AI 协作协议

### 解决问题

- 遇到问题: 先分析根本原因，再提出方案
- 不接受: "先这样绕过"、"加个判断跳过"
- 复杂修复: 说明根本原因，等待确认后再动手

### 代码质量

- 发现重复代码: 主动指出并提议合并
- 发现死代码: 主动指出并建议删除
- 发现设计问题: 指出问题本质，提供重构建议

### 工作方式

- 不确定时: 询问确认，不要猜测
- 修改前: 先阅读理解现有代码
- 修改后: 说明改了什么、为什么改
- 发现无关问题: 指出但不"顺便"修复
- 学到项目新知识时: 发现值得记录的规范、命令、模式或坑点，主动提议更新 CLAUDE.md，需用户确认后才执行

### 交付标准

- 完整实现需求，不做简化版/演示版
- 不遗留 TODO 或"后续可以扩展"
- 代码可直接运行，不需要人工补充

### 验证方式

- 完成前必须验证: 运行测试/检查，确认无错误
- 验证失败时: 查看错误、修复、重新验证，循环直到通过
- 不要假设正确: 能验证的就验证，不要说"应该没问题"
- 新代码: 确认有对应测试
- 修改代码: 运行相关测试
- 删除代码: 确认无引用

## 语言/框架特定规则

根据项目技术栈添加，不适用则删除此章节

### Python 项目

- 遵循 PEP8
- 使用类型提示
- 禁止裸 except
- 使用 f-string 格式化
  
### C++ 项目
- 禁止裸指针管理资源：优先 RAII（unique_ptr/shared_ptr）
- Eigen:避免在热路径反复分配临时矩阵
- 注意对齐（EIGEN_MAKE_ALIGNED_OPERATOR_NEW）与容器对齐
日志:
- 统一 glog INFO+ __func__+.....的格式 cyber
 ros 对应 ros的风格

### 函数头注释风格（必须为中文）

- 所有公共函数、复杂函数必须在函数头部提供注释，包含：

-  功能概述

- 输入/输出（含单位与坐标系）

- 关键假设与边界条件

- 错误/异常行为

- 时间复杂度或性能敏感点（如关键路径）
  
### 界面输出风格 为中文
